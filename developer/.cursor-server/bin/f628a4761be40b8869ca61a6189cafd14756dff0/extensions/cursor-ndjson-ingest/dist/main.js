(()=>{"use strict";var e={184:function(e,r,t){var n,o=this&&this.__createBinding||(Object.create?function(e,r,t,n){void 0===n&&(n=t);var o=Object.getOwnPropertyDescriptor(r,t);o&&!("get"in o?!r.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,n,o)}:function(e,r,t,n){void 0===n&&(n=t),e[n]=r[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),i=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var r=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[r.length]=t);return r},n(e)},function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t=n(e),i=0;i<t.length;i++)"default"!==t[i]&&o(r,e,t[i]);return s(r,e),r});Object.defineProperty(r,"__esModule",{value:!0}),r.activate=async function(e){l.NdjsonIngestLogger.init(),e.subscriptions.push(a.commands.registerCommand("cursor.ndjsonIngest.start",()=>async function(e){if(!a.workspace.isTrusted)return void a.window.showWarningMessage("debug mode disabled in untrusted workspace.");const r=a.workspace.workspaceFolders?.[0];if(!r)return void a.window.showErrorMessage("No workspace storage available (open a folder/workspace).");if(p)return{externalUrl:h,logPath:w};const t=a.workspace.getConfiguration("ndjson"),n=t.get("relativeLogFile",".cursor/debug.log"),o=a.Uri.joinPath(r.uri,n);u.mkdirSync((0,d.dirname)(o.fsPath),{recursive:!0}),w=o.fsPath;const s=e.workspaceState.get("nrdjson.targetId",crypto.randomUUID());e.workspaceState.update("nrdjson.targetId",s),p=c.createServer((e,r)=>(r.setHeader("Access-Control-Allow-Origin","*"),r.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),r.setHeader("Access-Control-Allow-Headers","Content-Type"),"OPTIONS"===e.method?(r.writeHead(200),void r.end()):"POST"!==e.method||e.url!==`/ingest/${s}`?(r.writeHead(404),void r.end()):void async function(e,r){const t=()=>new Promise((t,n)=>{const o=u.createWriteStream(r,{flags:"a"});(0,g.pipeline)(e,function(){let e=10;return new g.Transform({transform(r,t,n){e=r[r.length-1],n(null,r)},flush(r){10!==e&&this.push(Buffer.from("\n")),r()}})}(),o,e=>{e?n(e):t()})}),n=m.then(t,t);return m=n.catch(e=>{l.NdjsonIngestLogger.error("Error appending to log file:",e)}),n}(e,w).then(()=>{r.writeHead(204),r.end()}).catch(e=>{l.NdjsonIngestLogger.error("NDJSON ingest write error:",e),r.writeHead(500),r.end("write-failed")})));const i=t.get("port",0),v=t.get("bindAddress","127.0.0.1");let b;const j=new Promise(e=>b=e);return p.once("error",e=>{switch(e.code){case"EADDRINUSE":l.NdjsonIngestLogger.error(`Port ${i} is already in use`),a.window.showErrorMessage(`NDJSON Ingest: Cannot start server - port ${i} is already in use. Try changing the port in settings or stopping the other service.`,"Change Port").then(e=>{"Change Port"===e&&a.commands.executeCommand("workbench.action.openSettings","ndjson.port")}),b("Port is already in use");break;case"EACCES":l.NdjsonIngestLogger.error(`Permission denied for port ${i}`),a.window.showErrorMessage(`NDJSON Ingest: Permission denied for port ${i}. Try using a port number greater than 1024.`,"Change Port").then(e=>{"Change Port"===e&&a.commands.executeCommand("workbench.action.openSettings","ndjson.port")}),b(`Permission denied for port ${i}`);break;default:l.NdjsonIngestLogger.error("NDJSON ingest server listen error:",e),a.window.showErrorMessage(`NDJSON Ingest: Server error - ${e.message}`),b(`Server error - ${e.message}`)}p=void 0}),p.listen(i,v,async()=>{const e=p.address();f="object"==typeof e&&e?e.port:0;const r=a.Uri.parse(`http://${v}:${f}/ingest/${s}`);try{const e=await a.env.asExternalUri(r);h=e.toString()}catch(e){l.NdjsonIngestLogger.error("asExternalUri failed; using loopback URL",e),h=r.toString()}try{u.existsSync(w)&&u.unlinkSync(w)}catch(e){l.NdjsonIngestLogger.error("Error clearing existing log file:",e)}l.NdjsonIngestLogger.info(`NDJSON ingest server started on port ${f}`),a.window.showInformationMessage(`Debug server listening on ${h}`),b({externalUrl:h,logPath:w})}),j}(e))),e.subscriptions.push(a.commands.registerCommand("cursor.ndjsonIngest.stop",()=>v())),e.subscriptions.push(a.commands.registerCommand("cursor.ndjsonIngest.copyCurl",async()=>{if(!h)return void a.window.showWarningMessage("Server is not running.");const e=`curl -sS -H "Content-Type: application/x-ndjson" --data-binary '{"hello":"world"}' "${h.toString()}"`;await a.env.clipboard.writeText(e),a.window.showInformationMessage("NDJSON Ingest: curl command copied to clipboard.")})),e.subscriptions.push(a.commands.registerCommand("cursor.ndjsonIngest.showStatus",()=>{h?a.window.showInformationMessage(`URL: ${h.toString()}`):a.window.showInformationMessage("NDJSON: server not running.")}))},r.deactivate=async function(){await v()};const a=i(t(398)),c=i(t(611)),u=i(t(896)),d=t(928),g=t(203),l=t(377);let p,f=0,w="",h="",m=Promise.resolve();async function v(){l.NdjsonIngestLogger.info("Stopping NDJSON ingest server"),p&&(await new Promise(e=>p.close(()=>e())).catch(e=>{l.NdjsonIngestLogger.error("Error stopping NDJSON ingest server:",e)}),p=void 0)}},203:e=>{e.exports=require("stream")},377:function(e,r,t){var n,o=this&&this.__createBinding||(Object.create?function(e,r,t,n){void 0===n&&(n=t);var o=Object.getOwnPropertyDescriptor(r,t);o&&!("get"in o?!r.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,n,o)}:function(e,r,t,n){void 0===n&&(n=t),e[n]=r[t]}),s=this&&this.__setModuleDefault||(Object.create?function(e,r){Object.defineProperty(e,"default",{enumerable:!0,value:r})}:function(e,r){e.default=r}),i=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var r=[];for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[r.length]=t);return r},n(e)},function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t=n(e),i=0;i<t.length;i++)"default"!==t[i]&&o(r,e,t[i]);return s(r,e),r});Object.defineProperty(r,"__esModule",{value:!0}),r.NdjsonIngestLogger=void 0;const a=i(t(398));class c{static init(){c.output=a.window.createOutputChannel("NDJSON Ingest",{log:!0})}static error(e,...r){c.output||c.init(),c.output?.error(e,...r)}static warn(e,...r){c.output||c.init(),c.output?.warn(e,...r)}static info(e,...r){c.output||c.init(),c.output?.info(e,...r)}static debug(e,...r){c.output||c.init(),c.output?.debug(e,...r)}static trace(e,...r){c.output||c.init(),c.output?.trace(e,...r)}}r.NdjsonIngestLogger=c},398:e=>{e.exports=require("vscode")},611:e=>{e.exports=require("http")},896:e=>{e.exports=require("fs")},928:e=>{e.exports=require("path")}},r={},t=function t(n){var o=r[n];if(void 0!==o)return o.exports;var s=r[n]={exports:{}};return e[n].call(s.exports,s,s.exports,t),s.exports}(184),n=exports;for(var o in t)n[o]=t[o];t.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
//# sourceMappingURL=http://go/sourcemap/sourcemaps/f628a4761be40b8869ca61a6189cafd14756dff0/extensions/cursor-ndjson-ingest/dist/main.js.map