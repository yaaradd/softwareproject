(()=>{"use strict";var t={1943:t=>{t.exports=require("fs/promises")},6928:t=>{t.exports=require("path")},8388:function(t,e,r){var a,n=this&&this.__createBinding||(Object.create?function(t,e,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(e,r);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,a,n)}:function(t,e,r,a){void 0===a&&(a=r),t[a]=e[r]}),s=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),i=this&&this.__importStar||(a=function(t){return a=Object.getOwnPropertyNames||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[e.length]=r);return e},a(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r=a(t),i=0;i<r.length;i++)"default"!==r[i]&&n(e,t,r[i]);return s(e,t),e});Object.defineProperty(e,"__esModule",{value:!0});const c=i(r(1943)),o=i(r(6928));async function u(t){const e=[];try{const r=await c.readdir(t,{withFileTypes:!0});for(const a of r){const r=o.join(t,a.name);if(a.isDirectory()){const t=await u(r);e.push(...t)}else e.push(r)}}catch{}return e}async function l(t){try{const e=o.join(t,".git","HEAD"),r=await c.readFile(e,"utf-8");if(r.startsWith("ref: ")){const e=r.slice(5).trim(),a=o.join(t,".git",e);return(await c.readFile(a,"utf-8")).trim()}return r.trim()}catch{return null}}async function f(t){try{const e=o.join(t,".git","HEAD"),r=await c.readFile(e,"utf-8");return r.startsWith("ref: ")?r.slice(5).trim().replace("refs/heads/",""):null}catch{return null}}async function h(t){try{const e=o.join(t,".git","refs","heads");return(await u(e)).map(t=>t.replace(e+o.sep,""))}catch{return[]}}async function p(t){try{const e=o.join(t,".git","refs","tags");return(await u(e)).map(t=>t.replace(e+o.sep,""))}catch{return[]}}async function w(t){try{const e=o.join(t,".git","refs","remotes"),r=await u(e),a=[];for(const t of r){const r=await c.readFile(t,"utf-8"),n=t.replace(e+o.sep,"");a.push([n,r.trim()])}return a}catch{return[]}}async function g(t){try{const e=o.join(t,".git","refs","remotes","origin","HEAD");try{const t=await c.readFile(e,"utf-8");if(t.startsWith("ref: "))return t.slice(5).trim().replace("refs/remotes/origin/","")}catch{}const r=o.join(t,".git","config"),a=(await c.readFile(r,"utf-8")).match(/\[init\]\s*\n\s*defaultBranch\s*=\s*(.+)/);if(a)return a[1].trim();const n=await h(t);return n.includes("main")?"main":n.includes("master")?"master":null}catch{return null}}async function d(t){try{const e=o.join(t,".git","FETCH_HEAD");return(await c.readFile(e,"utf-8")).split("\n")[0]}catch{return null}}async function y(t){try{const e=o.join(t,".git","refs","stash");return(await c.readFile(e,"utf-8")).trim()}catch{return null}}async function m(t){try{return await c.stat(t),!0}catch{return!1}}process.on("message",async t=>{const e=await async function(t){try{let e;switch(t.type){case"getRepoState":e=await async function(t){const[e,r,a,n,s,i,c,o]=await Promise.all([l(t),f(t),g(t),h(t),p(t),w(t),d(t),y(t)]);return{commitHash:e,currentBranch:r,defaultBranch:a,branches:n,tags:s,remoteRefs:i,fetchHead:c,stashHash:o}}(t.workspacePath);break;case"getBranches":e=await h(t.workspacePath);break;case"getTags":e=await p(t.workspacePath);break;case"getRemoteRefs":e=await w(t.workspacePath);break;case"getCurrentCommitHash":e=await l(t.workspacePath);break;case"getCurrentBranch":e=await f(t.workspacePath);break;case"getDefaultBranch":e=await g(t.workspacePath);break;case"getFetchHead":e=await d(t.workspacePath);break;case"getStashHash":e=await y(t.workspacePath);break;case"isRebasing":e=await async function(t){const e=o.join(t,".git","rebase-merge"),r=o.join(t,".git","rebase-apply"),[a,n]=await Promise.all([m(e),m(r)]);return a||n}(t.workspacePath);break;case"fileExists":e=await m(t.args?.filePath);break;case"getRemoteUrl":e=await async function(t,e="origin"){try{const r=o.join(t,".git","config"),a=await c.readFile(r,"utf-8"),n=`[remote "${e}"]`,s=a.indexOf(n);if(-1===s)return null;const i=a.slice(s).match(/\s*url\s*=\s*(.+)$/m);return i&&i[1]?i[1].trim():null}catch{return null}}(t.workspacePath,t.args?.remoteName);break;default:{const e=t.type;throw new Error(`Unknown request type: ${e}`)}}return{id:t.id,success:!0,result:e}}catch(e){return{id:t.id,success:!1,error:e instanceof Error?e.message:String(e)}}}(t);process.send?.(e)}),process.send?.({type:"ready"})}},e={},r=function r(a){var n=e[a];if(void 0!==n)return n.exports;var s=e[a]={exports:{}};return t[a].call(s.exports,s,s.exports,r),s.exports}(8388),a=exports;for(var n in r)a[n]=r[n];r.__esModule&&Object.defineProperty(a,"__esModule",{value:!0})})();
//# sourceMappingURL=http://go/sourcemap/sourcemaps/32cfbe848b35d9eb320980195985450f244b3030/extensions/cursor-always-local/dist/gitWorker.js.map