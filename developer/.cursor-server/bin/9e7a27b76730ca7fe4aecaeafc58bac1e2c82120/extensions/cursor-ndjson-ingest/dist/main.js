(()=>{"use strict";var e={184:function(e,t,r){var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),i=0;i<r.length;i++)"default"!==r[i]&&o(t,e,r[i]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=async function(e){l.NdjsonIngestLogger.init(),e.subscriptions.push(a.commands.registerCommand("cursor.ndjsonIngest.start",()=>async function(){if(!a.workspace.isTrusted)return void a.window.showWarningMessage("debug mode disabled in untrusted workspace.");const e=a.workspace.workspaceFolders?.[0];if(!e)return void a.window.showErrorMessage("No workspace storage available (open a folder/workspace).");if(p)return{externalUrl:h,logPath:w};const t=a.workspace.getConfiguration("ndjson"),r=t.get("relativeLogFile",".cursor/debug.log"),n=a.Uri.joinPath(e.uri,r);u.mkdirSync((0,d.dirname)(n.fsPath),{recursive:!0}),w=n.fsPath,p=c.createServer((e,t)=>(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type"),"OPTIONS"===e.method?(t.writeHead(200),void t.end()):"POST"!==e.method||"/ingest"!==e.url?(t.writeHead(404),void t.end()):void async function(e,t){const r=()=>new Promise((r,n)=>{const o=u.createWriteStream(t,{flags:"a"});(0,g.pipeline)(e,function(){let e=10;return new g.Transform({transform(t,r,n){e=t[t.length-1],n(null,t)},flush(t){10!==e&&this.push(Buffer.from("\n")),t()}})}(),o,e=>{e?n(e):r()})}),n=v.then(r,r);return v=n.catch(e=>{l.NdjsonIngestLogger.error("Error appending to log file:",e)}),n}(e,w).then(()=>{t.writeHead(204),t.end()}).catch(e=>{l.NdjsonIngestLogger.error("NDJSON ingest write error:",e),t.writeHead(500),t.end("write-failed")})));const o=t.get("port",0),s=t.get("bindAddress","127.0.0.1");let i;const m=new Promise(e=>i=e);return p.once("error",e=>{l.NdjsonIngestLogger.error("NDJSON ingest server listen error:",e),p=void 0,i()}),p.listen(o,s,async()=>{const e=p.address();f="object"==typeof e&&e?e.port:0;const t=a.Uri.parse(`http://${s}:${f}/ingest`);try{const e=await a.env.asExternalUri(t);h=e.toString()}catch(e){l.NdjsonIngestLogger.error("asExternalUri failed; using loopback URL",e),h=t.toString()}try{u.existsSync(w)&&u.unlinkSync(w)}catch(e){l.NdjsonIngestLogger.error("Error clearing existing log file:",e)}l.NdjsonIngestLogger.info(`NDJSON ingest server started on port ${f}`),i({externalUrl:h,logPath:w})}),m}())),e.subscriptions.push(a.commands.registerCommand("cursor.ndjsonIngest.stop",()=>m())),e.subscriptions.push(a.commands.registerCommand("cursor.ndjsonIngest.copyCurl",async()=>{if(!h)return void a.window.showWarningMessage("Server is not running.");const e=`curl -sS -H "Content-Type: application/x-ndjson" --data-binary '{"hello":"world"}' "${h.toString()}"`;await a.env.clipboard.writeText(e),a.window.showInformationMessage("NDJSON Ingest: curl command copied to clipboard.")})),e.subscriptions.push(a.commands.registerCommand("cursor.ndjsonIngest.showStatus",()=>{h?a.window.showInformationMessage(`URL: ${h.toString()}`):a.window.showInformationMessage("NDJSON: server not running.")}))},t.deactivate=async function(){await m()};const a=i(r(398)),c=i(r(611)),u=i(r(896)),d=r(928),g=r(203),l=r(377);let p,f=0,w="",h="",v=Promise.resolve();async function m(){l.NdjsonIngestLogger.info("Stopping NDJSON ingest server"),p&&(await new Promise(e=>p.close(()=>e())).catch(e=>{l.NdjsonIngestLogger.error("Error stopping NDJSON ingest server:",e)}),p=void 0)}},203:e=>{e.exports=require("stream")},377:function(e,t,r){var n,o=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(t,r);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,o)}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[t.length]=r);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r=n(e),i=0;i<r.length;i++)"default"!==r[i]&&o(t,e,r[i]);return s(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.NdjsonIngestLogger=void 0;const a=i(r(398));class c{static init(){c.output=a.window.createOutputChannel("NDJSON Ingest",{log:!0})}static error(e,...t){c.output||c.init(),c.output?.error(e,...t)}static warn(e,...t){c.output||c.init(),c.output?.warn(e,...t)}static info(e,...t){c.output||c.init(),c.output?.info(e,...t)}static debug(e,...t){c.output||c.init(),c.output?.debug(e,...t)}static trace(e,...t){c.output||c.init(),c.output?.trace(e,...t)}}t.NdjsonIngestLogger=c},398:e=>{e.exports=require("vscode")},611:e=>{e.exports=require("http")},896:e=>{e.exports=require("fs")},928:e=>{e.exports=require("path")}},t={},r=function r(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}(184),n=exports;for(var o in r)n[o]=r[o];r.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();
//# sourceMappingURL=http://go/sourcemap/sourcemaps/9e7a27b76730ca7fe4aecaeafc58bac1e2c82120/extensions/cursor-ndjson-ingest/dist/main.js.map